set x outer-x
fn hello {} {
    assert {$x eq "outer-x"}
}
fn nested {} {
    fn inside {} {
        __exit 0
    }
    inside
}

When {
    set x inner-x
    When {
        hello
        nested
    }
}
