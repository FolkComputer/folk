When { source builtin-programs/collect.folk }

Claim an item is A
Claim an item is B
Claim an item is C

When we should collect {
    When the collected results for [list an item is /item/] are /results/ {
        puts $results
    }
}

#################

for {set i 0} {$i < 5} {incr i} {
    puts "$i ---------------"

    Assert! we should collect
    sleep 0.2

    set results [Query! the collected results for [list an item is /item/] are /results/]
    assert {[llength [dict get [lindex $results 0] results]] == 3}

    Retract! we should collect
    sleep 0.4

    set results [Query! the collected results for [list an item is /item/] are /results/]
    assert {[llength $results] == 0}
}

Exit! 0
