When { source virtual-programs/collect.folk }

Claim an item is A
Claim an item is B
Claim an item is C

When we should collect {
    When the collected matches for [list an item is /item/] are /matches/ {
        puts $matches
    }
}

#################

for {set i 0} {$i < 5} {incr i} {
    puts "$i ---------------"

    Assert! we should collect
    sleep 0.2

    set results [Query! the collected matches for [list an item is /item/] are /matches/]
    assert {[llength [dict get [lindex $results 0] matches]] == 3}

    Retract! we should collect
    sleep 0.4

    set results [Query! the collected matches for [list an item is /item/] are /matches/]
    assert {[llength $results] == 0}
}
