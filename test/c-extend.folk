
set cc [C]
$cc define {
    __thread int globx = 10;
    int whatever;
}
$cc proc incr_globx {} void {
    globx++;
}
set clib [$cc compile]
$clib incr_globx

puts ================

set dd [C]
$dd extend $clib
$dd proc go {} int {
    incr_globx();
    incr_globx();
    return getGlobx();
}
set dlib [$dd compile]

set ret [$dlib go]
puts "dlib go = $ret"
assert {$ret == 13}
__conclude 0
