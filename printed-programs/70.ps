
        %!PS
        << /PageSize [612 792] >> setpagedevice

        /Courier findfont
        12 scalefont
        setfont
        newpath
        36 738.0 moveto (source "pi/critclUtils.tcl") show
36 720.0 moveto () show
36 702.0 moveto (set cc [c create]) show
36 684.0 moveto (if {[info hostname] != "scoriae.local"} {) show
36 666.0 moveto (    $cc cflags -I$::env(HOME)/apriltag -Wall -Werror $::env(HOME)/apriltag/libapriltag.a) show
36 648.0 moveto (} else {) show
36 630.0 moveto (    $cc cflags -I/Users/osnr/aux/apriltag -Wall -Werror /Users/osnr/aux/apriltag/libapriltag.a) show
36 612.0 moveto (}) show
36 594.0 moveto () show
36 576.0 moveto ($cc code {) show
36 558.0 moveto (    #include <apriltag.h>) show
36 540.0 moveto (    #include <tagStandard52h13.h>) show
36 522.0 moveto (    apriltag_family_t *tf = NULL;) show
36 504.0 moveto () show
36 486.0 moveto (    #define emit(...) i += sprintf(&ret[i], __VA_ARGS__)) show
36 468.0 moveto (}) show
36 450.0 moveto ($cc proc tagImageForId {int id} char* {) show
36 432.0 moveto (    if (tf == NULL) tf = tagStandard52h13_create();) show
36 414.0 moveto () show
36 396.0 moveto (    image_u8_t* image = apriltag_to_image(tf, id);) show
36 378.0 moveto () show
36 360.0 moveto (    char* ret = Tcl_Alloc(10000);) show
36 342.0 moveto (    int i = 0;) show
36 324.0 moveto (    emit("gsave\\n");) show
36 306.0 moveto (    emit("0 1 translate\\n");) show
36 288.0 moveto (    emit("%f %f scale\\n", 1.0/image->width, -1.0/image->height);) show
36 270.0 moveto (    for (int row = 0; row < image->height; row++) {) show
36 252.0 moveto (        for (int col = 0; col < image->width; col++) {) show
36 234.0 moveto (            uint8_t pixel = image->buf[(row * image->stride) + col];) show
36 216.0 moveto (            emit("%d setgray ", pixel != 0);) show
36 198.0 moveto (            emit("newpath ");) show
36 180.0 moveto (            emit("%d %d moveto ", col, row); // bottom-left) show
36 162.0 moveto (            emit("%d %d lineto ", col + 1, row); // bottom-right) show
36 144.0 moveto (            emit("%d %d lineto ", col + 1, row + 1); // top-right) show
36 126.0 moveto (            emit("%d %d lineto ", col, row + 1); // top-left) show
36 108.0 moveto (            emit("closepath fill ");) show
36 90.0 moveto (        }) show
36 72.0 moveto (        emit("\\n");) show
36 54.0 moveto (    }) show
36 36.0 moveto (    emit("grestore\\n");) show
36 18.0 moveto (    ret[i++] = '\\0';) show
36 0.0 moveto (    image_u8_destroy(image);) show
36 -18.0 moveto (    return ret;) show
36 -36.0 moveto (}) show
36 -54.0 moveto ($cc compile) show
36 -72.0 moveto () show
36 -90.0 moveto (proc programToPs {id text} {) show
36 -108.0 moveto (    set PageWidth 612; set PageHeight 792) show
36 -126.0 moveto (    set margin 36) show
36 -144.0 moveto () show
36 -162.0 moveto (    set tagwidth 150; set tagheight 150) show
36 -180.0 moveto (    set fontsize 12; set lineheight [expr $fontsize*1.5]) show
36 -198.0 moveto () show
36 -216.0 moveto (    set image [tagImageForId $id]) show
36 -234.0 moveto () show
36 -252.0 moveto (    set linenum 1) show
36 -270.0 moveto (    return [subst {) show
36 -288.0 moveto (        %!PS) show
36 -306.0 moveto (        << /PageSize \\[$PageWidth $PageHeight\\] >> setpagedevice) show
36 -324.0 moveto () show
36 -342.0 moveto (        /Courier findfont) show
36 -360.0 moveto (        $fontsize scalefont) show
36 -378.0 moveto (        setfont) show
36 -396.0 moveto (        newpath) show
36 -414.0 moveto (        [join [lmap line [split $text "\\n"] {) show
36 -432.0 moveto (            set line [string map {"\\\\" "\\\\\\\\"} $line]) show
36 -450.0 moveto (            set ret "$margin [expr $PageHeight-$margin-$linenum*$lineheight] moveto ($line) show") show
36 -468.0 moveto (            incr linenum) show
36 -486.0 moveto (            set ret) show
36 -504.0 moveto (        }] "\\n"]) show
36 -522.0 moveto () show
36 -540.0 moveto (        gsave) show
36 -558.0 moveto (        [expr $PageWidth-$tagwidth-$margin] [expr $PageHeight-$tagheight-$margin] translate) show
36 -576.0 moveto (        $tagwidth $tagheight scale) show
36 -594.0 moveto (        $image) show
36 -612.0 moveto (        grestore) show
36 -630.0 moveto () show
36 -648.0 moveto (        /Helvetica-Narrow findfont) show
36 -666.0 moveto (        10 scalefont) show
36 -684.0 moveto (        setfont) show
36 -702.0 moveto (        newpath) show
36 -720.0 moveto (        [expr $PageWidth-$tagwidth-$margin] [expr $PageHeight-$tagheight-16-$margin] moveto) show
36 -738.0 moveto (        ($id ([clock format [clock seconds] -format "%a, %d %b %Y, %r"])) show) show
36 -756.0 moveto (    }]) show
36 -774.0 moveto (}) show
36 -792.0 moveto () show
36 -810.0 moveto (proc nextId {} {) show
36 -828.0 moveto (     set fp [open "printed-programs/next-id.txt" r]) show
36 -846.0 moveto (     set id [string trim [read $fp]]) show
36 -864.0 moveto (     close $fp) show
36 -882.0 moveto () show
36 -900.0 moveto (     set fp [open "printed-programs/next-id.txt" w]) show
36 -918.0 moveto (     puts $fp [expr {$id + 1}]) show
36 -936.0 moveto (     close $fp) show
36 -954.0 moveto () show
36 -972.0 moveto (     return $id) show
36 -990.0 moveto (}) show
36 -1008.0 moveto () show
36 -1026.0 moveto (if {$::tcl_platform(os) eq "Darwin"} { return }) show
36 -1044.0 moveto () show
36 -1062.0 moveto (if {![info exists ::printjobs]} {set ::printjobs [dict create]}) show
36 -1080.0 moveto (When /someone/ wishes to print /code/ with job id /jobid/ {) show
36 -1098.0 moveto (    puts "Wish to print jobid $jobid") show
36 -1116.0 moveto (    if {[dict exists $::printjobs $jobid]} {return}) show
36 -1134.0 moveto (    dict set ::printjobs $jobid true) show
36 -1152.0 moveto () show
36 -1170.0 moveto (    set id [nextId]) show
36 -1188.0 moveto () show
36 -1206.0 moveto (    set ps [programToPs $id $code]) show
36 -1224.0 moveto () show
36 -1242.0 moveto (    # save code and ps to disk) show
36 -1260.0 moveto (    set fp [open "printed-programs/$id.folk" w]) show
36 -1278.0 moveto (    puts $fp $code) show
36 -1296.0 moveto (    close $fp) show
36 -1314.0 moveto () show
36 -1332.0 moveto (    set fp [open "printed-programs/$id.ps" w]) show
36 -1350.0 moveto (    puts $fp $ps) show
36 -1368.0 moveto (    close $fp) show
36 -1386.0 moveto () show
36 -1404.0 moveto (    exec ps2pdf printed-programs/$id.ps printed-programs/$id.pdf) show
36 -1422.0 moveto (    exec lpr printed-programs/$id.pdf) show
36 -1440.0 moveto (}) show
36 -1458.0 moveto () show

        gsave
        426 606 translate
        150 150 scale
        gsave
0 1 translate
0.100000 -0.100000 scale
0 setgray newpath 0 0 moveto 1 0 lineto 1 1 lineto 0 1 lineto closepath fill 1 setgray newpath 1 0 moveto 2 0 lineto 2 1 lineto 1 1 lineto closepath fill 0 setgray newpath 2 0 moveto 3 0 lineto 3 1 lineto 2 1 lineto closepath fill 0 setgray newpath 3 0 moveto 4 0 lineto 4 1 lineto 3 1 lineto closepath fill 0 setgray newpath 4 0 moveto 5 0 lineto 5 1 lineto 4 1 lineto closepath fill 0 setgray newpath 5 0 moveto 6 0 lineto 6 1 lineto 5 1 lineto closepath fill 0 setgray newpath 6 0 moveto 7 0 lineto 7 1 lineto 6 1 lineto closepath fill 0 setgray newpath 7 0 moveto 8 0 lineto 8 1 lineto 7 1 lineto closepath fill 0 setgray newpath 8 0 moveto 9 0 lineto 9 1 lineto 8 1 lineto closepath fill 1 setgray newpath 9 0 moveto 10 0 lineto 10 1 lineto 9 1 lineto closepath fill 
1 setgray newpath 0 1 moveto 1 1 lineto 1 2 lineto 0 2 lineto closepath fill 0 setgray newpath 1 1 moveto 2 1 lineto 2 2 lineto 1 2 lineto closepath fill 0 setgray newpath 2 1 moveto 3 1 lineto 3 2 lineto 2 2 lineto closepath fill 0 setgray newpath 3 1 moveto 4 1 lineto 4 2 lineto 3 2 lineto closepath fill 0 setgray newpath 4 1 moveto 5 1 lineto 5 2 lineto 4 2 lineto closepath fill 0 setgray newpath 5 1 moveto 6 1 lineto 6 2 lineto 5 2 lineto closepath fill 0 setgray newpath 6 1 moveto 7 1 lineto 7 2 lineto 6 2 lineto closepath fill 0 setgray newpath 7 1 moveto 8 1 lineto 8 2 lineto 7 2 lineto closepath fill 0 setgray newpath 8 1 moveto 9 1 lineto 9 2 lineto 8 2 lineto closepath fill 1 setgray newpath 9 1 moveto 10 1 lineto 10 2 lineto 9 2 lineto closepath fill 
1 setgray newpath 0 2 moveto 1 2 lineto 1 3 lineto 0 3 lineto closepath fill 0 setgray newpath 1 2 moveto 2 2 lineto 2 3 lineto 1 3 lineto closepath fill 1 setgray newpath 2 2 moveto 3 2 lineto 3 3 lineto 2 3 lineto closepath fill 1 setgray newpath 3 2 moveto 4 2 lineto 4 3 lineto 3 3 lineto closepath fill 1 setgray newpath 4 2 moveto 5 2 lineto 5 3 lineto 4 3 lineto closepath fill 1 setgray newpath 5 2 moveto 6 2 lineto 6 3 lineto 5 3 lineto closepath fill 1 setgray newpath 6 2 moveto 7 2 lineto 7 3 lineto 6 3 lineto closepath fill 1 setgray newpath 7 2 moveto 8 2 lineto 8 3 lineto 7 3 lineto closepath fill 0 setgray newpath 8 2 moveto 9 2 lineto 9 3 lineto 8 3 lineto closepath fill 0 setgray newpath 9 2 moveto 10 2 lineto 10 3 lineto 9 3 lineto closepath fill 
1 setgray newpath 0 3 moveto 1 3 lineto 1 4 lineto 0 4 lineto closepath fill 0 setgray newpath 1 3 moveto 2 3 lineto 2 4 lineto 1 4 lineto closepath fill 1 setgray newpath 2 3 moveto 3 3 lineto 3 4 lineto 2 4 lineto closepath fill 1 setgray newpath 3 3 moveto 4 3 lineto 4 4 lineto 3 4 lineto closepath fill 1 setgray newpath 4 3 moveto 5 3 lineto 5 4 lineto 4 4 lineto closepath fill 0 setgray newpath 5 3 moveto 6 3 lineto 6 4 lineto 5 4 lineto closepath fill 1 setgray newpath 6 3 moveto 7 3 lineto 7 4 lineto 6 4 lineto closepath fill 1 setgray newpath 7 3 moveto 8 3 lineto 8 4 lineto 7 4 lineto closepath fill 0 setgray newpath 8 3 moveto 9 3 lineto 9 4 lineto 8 4 lineto closepath fill 0 setgray newpath 9 3 moveto 10 3 lineto 10 4 lineto 9 4 lineto closepath fill 
0 setgray newpath 0 4 moveto 1 4 lineto 1 5 lineto 0 5 lineto closepath fill 0 setgray newpath 1 4 moveto 2 4 lineto 2 5 lineto 1 5 lineto closepath fill 1 setgray newpath 2 4 moveto 3 4 lineto 3 5 lineto 2 5 lineto closepath fill 0 setgray newpath 3 4 moveto 4 4 lineto 4 5 lineto 3 5 lineto closepath fill 0 setgray newpath 4 4 moveto 5 4 lineto 5 5 lineto 4 5 lineto closepath fill 1 setgray newpath 5 4 moveto 6 4 lineto 6 5 lineto 5 5 lineto closepath fill 0 setgray newpath 6 4 moveto 7 4 lineto 7 5 lineto 6 5 lineto closepath fill 1 setgray newpath 7 4 moveto 8 4 lineto 8 5 lineto 7 5 lineto closepath fill 0 setgray newpath 8 4 moveto 9 4 lineto 9 5 lineto 8 5 lineto closepath fill 1 setgray newpath 9 4 moveto 10 4 lineto 10 5 lineto 9 5 lineto closepath fill 
1 setgray newpath 0 5 moveto 1 5 lineto 1 6 lineto 0 6 lineto closepath fill 0 setgray newpath 1 5 moveto 2 5 lineto 2 6 lineto 1 6 lineto closepath fill 1 setgray newpath 2 5 moveto 3 5 lineto 3 6 lineto 2 6 lineto closepath fill 0 setgray newpath 3 5 moveto 4 5 lineto 4 6 lineto 3 6 lineto closepath fill 0 setgray newpath 4 5 moveto 5 5 lineto 5 6 lineto 4 6 lineto closepath fill 1 setgray newpath 5 5 moveto 6 5 lineto 6 6 lineto 5 6 lineto closepath fill 0 setgray newpath 6 5 moveto 7 5 lineto 7 6 lineto 6 6 lineto closepath fill 1 setgray newpath 7 5 moveto 8 5 lineto 8 6 lineto 7 6 lineto closepath fill 0 setgray newpath 8 5 moveto 9 5 lineto 9 6 lineto 8 6 lineto closepath fill 0 setgray newpath 9 5 moveto 10 5 lineto 10 6 lineto 9 6 lineto closepath fill 
1 setgray newpath 0 6 moveto 1 6 lineto 1 7 lineto 0 7 lineto closepath fill 0 setgray newpath 1 6 moveto 2 6 lineto 2 7 lineto 1 7 lineto closepath fill 1 setgray newpath 2 6 moveto 3 6 lineto 3 7 lineto 2 7 lineto closepath fill 0 setgray newpath 3 6 moveto 4 6 lineto 4 7 lineto 3 7 lineto closepath fill 0 setgray newpath 4 6 moveto 5 6 lineto 5 7 lineto 4 7 lineto closepath fill 1 setgray newpath 5 6 moveto 6 6 lineto 6 7 lineto 5 7 lineto closepath fill 0 setgray newpath 6 6 moveto 7 6 lineto 7 7 lineto 6 7 lineto closepath fill 1 setgray newpath 7 6 moveto 8 6 lineto 8 7 lineto 7 7 lineto closepath fill 0 setgray newpath 8 6 moveto 9 6 lineto 9 7 lineto 8 7 lineto closepath fill 0 setgray newpath 9 6 moveto 10 6 lineto 10 7 lineto 9 7 lineto closepath fill 
1 setgray newpath 0 7 moveto 1 7 lineto 1 8 lineto 0 8 lineto closepath fill 0 setgray newpath 1 7 moveto 2 7 lineto 2 8 lineto 1 8 lineto closepath fill 1 setgray newpath 2 7 moveto 3 7 lineto 3 8 lineto 2 8 lineto closepath fill 1 setgray newpath 3 7 moveto 4 7 lineto 4 8 lineto 3 8 lineto closepath fill 1 setgray newpath 4 7 moveto 5 7 lineto 5 8 lineto 4 8 lineto closepath fill 1 setgray newpath 5 7 moveto 6 7 lineto 6 8 lineto 5 8 lineto closepath fill 1 setgray newpath 6 7 moveto 7 7 lineto 7 8 lineto 6 8 lineto closepath fill 1 setgray newpath 7 7 moveto 8 7 lineto 8 8 lineto 7 8 lineto closepath fill 0 setgray newpath 8 7 moveto 9 7 lineto 9 8 lineto 8 8 lineto closepath fill 0 setgray newpath 9 7 moveto 10 7 lineto 10 8 lineto 9 8 lineto closepath fill 
0 setgray newpath 0 8 moveto 1 8 lineto 1 9 lineto 0 9 lineto closepath fill 0 setgray newpath 1 8 moveto 2 8 lineto 2 9 lineto 1 9 lineto closepath fill 0 setgray newpath 2 8 moveto 3 8 lineto 3 9 lineto 2 9 lineto closepath fill 0 setgray newpath 3 8 moveto 4 8 lineto 4 9 lineto 3 9 lineto closepath fill 0 setgray newpath 4 8 moveto 5 8 lineto 5 9 lineto 4 9 lineto closepath fill 0 setgray newpath 5 8 moveto 6 8 lineto 6 9 lineto 5 9 lineto closepath fill 0 setgray newpath 6 8 moveto 7 8 lineto 7 9 lineto 6 9 lineto closepath fill 0 setgray newpath 7 8 moveto 8 8 lineto 8 9 lineto 7 9 lineto closepath fill 0 setgray newpath 8 8 moveto 9 8 lineto 9 9 lineto 8 9 lineto closepath fill 1 setgray newpath 9 8 moveto 10 8 lineto 10 9 lineto 9 9 lineto closepath fill 
1 setgray newpath 0 9 moveto 1 9 lineto 1 10 lineto 0 10 lineto closepath fill 0 setgray newpath 1 9 moveto 2 9 lineto 2 10 lineto 1 10 lineto closepath fill 1 setgray newpath 2 9 moveto 3 9 lineto 3 10 lineto 2 10 lineto closepath fill 0 setgray newpath 3 9 moveto 4 9 lineto 4 10 lineto 3 10 lineto closepath fill 0 setgray newpath 4 9 moveto 5 9 lineto 5 10 lineto 4 10 lineto closepath fill 1 setgray newpath 5 9 moveto 6 9 lineto 6 10 lineto 5 10 lineto closepath fill 0 setgray newpath 6 9 moveto 7 9 lineto 7 10 lineto 6 10 lineto closepath fill 1 setgray newpath 7 9 moveto 8 9 lineto 8 10 lineto 7 10 lineto closepath fill 1 setgray newpath 8 9 moveto 9 9 lineto 9 10 lineto 8 10 lineto closepath fill 1 setgray newpath 9 9 moveto 10 9 lineto 10 10 lineto 9 10 lineto closepath fill 
grestore

        grestore

        /Helvetica-Narrow findfont
        10 scalefont
        setfont
        newpath
        426 590 moveto
        (70 (Sun, 04 Dec 2022, 09:07:02 pm)) show
    
